<div class="p-6 space-y-8 max-w-6xl mx-auto">

  <!-- PAGE TITLE + CREATE BUTTON -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <div class="space-y-1">
      <p class="text-sm uppercase tracking-[0.2em] text-[#0A516D]/70">Inventory Overview</p>
      <h2 class="page-title">Medicines</h2>
    </div>

    <button
      *ngIf="canEdit"
      routerLink="/medicines/create"
      class="btn btn-primary px-5"
    >
      + Add Medicine
    </button>
    <span *ngIf="!canEdit" class="text-sm text-slate-700 font-medium glass-panel px-4 py-2 rounded-full">
      View-only access
    </span>
  </div>

  <!-- SEARCH + RESET BAR -->
  <form class="w-full max-w-4xl mx-auto" (submit)="searchMedicines($event)">
    <label for="search" class="sr-only">Search</label>

    <div class="relative glass-panel rounded-full px-5 py-3 shadow-lg">

      <!-- Icon -->
      <div class="absolute inset-y-0 left-4 flex items-center pointer-events-none">
        <svg class="w-5 h-5 text-[#0A516D]" xmlns="http://www.w3.org/2000/svg" fill="none"
             viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-width="2"
                d="m21 21-3.5-3.5M17 10a7 7 0 1 1-14 0 7 7 0 0 1 14 0Z"/>
        </svg>
      </div>

      <!-- Input -->
      <input
        [(ngModel)]="searchTerm"
        name="search"
        id="search"
        type="search"
        placeholder="Search medicines, categories, or closets..."
        class="w-full bg-transparent text-slate-800 placeholder:text-slate-500 pl-10 pr-36 focus:outline-none"
      />

      <!-- Search Button -->
      <button
        type="button"
        (click)="applyFilter()"
        class="btn btn-primary absolute right-24 top-0 px-4 py-2"
      >
        Search
      </button>

      <!-- Reset Button -->
      <button
        type="button"
        (click)="resetSearch()"
        class="btn btn-secondary absolute right-3 top-0  px-4 py-2"
      >
        Reset
      </button>
    </div>
  </form>

  <!-- GROUPED BY CLOSET -->
  <div class="space-y-4">

    <details
      *ngFor="let closet of groupedByCloset | keyvalue : keyValueSorter"
      class="group glass-panel overflow-hidden"
    >
      <!-- Closet Header -->
      <summary
        class="accordion-header bg-white/15 backdrop-blur flex items-center justify-between"
      >
        <div class="space-y-1">
          <p class="text-xs uppercase tracking-[0.2em] text-[#0A516D]/70">Closet</p>
          <span class="capitalize text-lg font-semibold text-slate-900">{{ closet.key.replace('_', ' ') }}</span>
        </div>

        <div class="w-10 h-10 flex items-center justify-center rounded-full bg-white/40 border border-white/30 shadow-inner shadow-black/10">
          <svg class="w-5 h-5 text-[#0A516D] transition-transform duration-300 group-open:-rotate-180"
               xmlns="http://www.w3.org/2000/svg" fill="none"
               viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </div>
      </summary>

      <!-- Medicines Inside This Closet -->
      <div class="space-y-3 p-4 bg-white/10 backdrop-blur-sm">

        <div
          *ngFor="let med of closet.value"
          [routerLink]="['/medicines', med.id]"
          class="accordion-item shadow-black/10 hover:shadow-lg transition"
        >
          <div>
            <p class="font-semibold text-slate-900">{{ med.med_name }}</p>
            <p class="text-sm text-slate-600">{{ med.scientific_name }}</p>
          </div>

          <p class="font-semibold text-[#0A516D] text-right">
            {{ med.price }} JOD
          </p>
        </div>

      </div>
    </details>

  </div>

</div>
